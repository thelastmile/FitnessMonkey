<!DOCTYPE html>
<head>
	<title>Fitness Monkey Site</title>
	<!-- meta data -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- bootstrap 3 -->
	<link rel="stylesheet" type="text/css" href="../bootstrap/bootstrap-3.3.5/css/bootstrap.min.css">
	<!-- my styles -->
	<link rel="stylesheet" type="text/css" href="../lib/nv.d3.min.css">
	<link rel="stylesheet" type="text/css" href="../css/main.css">
	<script type="text/javascript" src="../lib/d3.v3.js"></script>
	<script type="text/javascript" src="../lib/nv.d3.min.js"></script>
</head>

<body>
	<div id="wrapper" class="container">
		<!-- Navbar content -->
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
			  <!-- Brand and toggle get grouped for better mobile display -->
			  <div class="navbar-header">
			    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			      <span class="sr-only">Toggle navigation</span>
			      <span class="icon-bar"></span>
			      <span class="icon-bar"></span>
			      <span class="icon-bar"></span>
			    </button>
			    <!-- <img id="logo" class="pull-left" src="assets/monkey.png"> -->
			    <a class="navbar-brand" href="#">Fitness Monkey</a>
			  </div>

			  <div>


			  <!-- Collect the nav links, forms, and other content for toggling -->
			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			    <ul class="nav navbar-nav navbar-right">
			    	<li><a href="#playbook">Playbook</a></li>
			      	<li><a href="#education">Education</a></li>
			      	<li><a href="#community">Community</a></li>
			      	<li><a href="#events">Events</a></li>
			      	<li><a href="#gear">Gear</a></li>
			    	<li><a href="#">Members: <span id="num">0</span></a></li>
			    </ul>
			  </div><!-- /.navbar-collapse -->
			</div><!-- /.container-fluid -->
		</nav>

		<div class="col-md-4">

			<div class="row">
				<h1>Data Side</h1>
				<div>
					Number of Workouts
					<h3 id="workoutNum">31</h3>
					<div class="btn btn-sm add"></div>
				</div>
				<div>
					Days since last relapse
					<h3 id="lastRelapse">63</h3>
				</div>
			</div>

			<div class="row">
				<form id="add-workout">
				  	<div class="form-group">
				    	<label for="type-input">What type of workout?</label>
				    	<input type="text" class="form-control" id="type-input" placeholder="Type of workout">
				  	</div>
				  	<div class="form-group">
				    	<label for="duration-input">What was the duration?</label>
				    	<input type="number" class="form-control" id="duration-input" placeholder="duration in minutes">
				  	</div>
				  	<div class="form-group">
				    	<label for="intensity-input">What was the intensity (1 - 9)</label>
				    	<input type="number" id="intensity-input">
				  	</div>
				  	<button type="submit" class="btn btn-default">Submit</button>
				</form>
			</div>
	</div>	

	<div class="col-md-8">
		chart
		<div id="workout-bar-chart">
			<svg></svg>
		</div>
	</div>


		
		
	</div>



	<script type="text/javascript" src="../lib/jquery.js"></script>
	<script type="text/javascript" src="../bootstrap/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../resources/holderJS_lite/lib/holder.min.js"></script>
	<script type="text/javascript" src="../scripts/joeScript.js"></script>
	<script type="text/javascript" src="../scripts/script.js"></script>


	<script type='text/javascript'>

		$(function() {
			var workoutData;

			var loadDataRenderCharts = function(data){
				workoutData = data.workouts;
				updateCharts();
			};

			function updateCharts(){
				$('#workoutNum').text(workoutData.length);
				buildDonutChart(dataTransformer.typeDonutChart(workoutData), "Workouts by Category", "#workout-bar-chart svg");
			};

			d3.json('../data/workouts.json', loadDataRenderCharts);

			function buildDonutChart(data, title, selector){

		    	var height = 350;
		    	var width = 350;

		    	var chart1;

			    nv.addGraph(function() {
			        var chart1 = nv.models.pieChart()
			            .x(function(d) { return d.key })
			            .y(function(d) { return d.y })
			            .donut(true)
			            .width(width)
			            .height(height)
			            .padAngle(.08)
			            .cornerRadius(5)
			            .id('donut1'); // allow custom CSS for this one svg

			        chart1.title(title);
			        chart1.pie.donutLabelsOutside(true).donut(true);

			        d3.select(selector)
			            .datum(dataTransformer.typeDonutChart(workoutData))
			            .transition().duration(1200)
			            .call(chart1);

			        //nv.utils.windowResize(chart1.update);

			        return chart1;

			    });
			}
			
			$('#add-workout').on('submit', function(e){
				e.preventDefault();
				var type = $('#type-input').val();
				var duration = $('#duration-input').val();
				var intensity = $('#intensity-input').val();
				var date = new Date();

				workoutData.push({date: date, type: type, duration: duration, intensity: intensity});
				updateCharts();
			});

			var dataTransformer = {
				typeDonutChart: function(data){
					var categoryObj = {};
					var results = [];

					data.forEach(function(obj){
						if(categoryObj[obj.category]){
							categoryObj[obj.category]++;
						} else {
							categoryObj[obj.category] = 1;
						}
					})
					for(var key in categoryObj){
						results.push({key: key, y: categoryObj[key]});
					}
					return results;
				}
			};


			





	})
	</script>
</body>