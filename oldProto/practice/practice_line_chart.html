<!DOCTYPE html>
<head>
	<title>Fitness Monkey Site</title>
	<!-- meta data -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- bootstrap 3 -->
	<link rel="stylesheet" type="text/css" href="../bootstrap/bootstrap-3.3.5/css/bootstrap.min.css">
	<!-- my styles -->
	<link rel="stylesheet" type="text/css" href="../lib/nv.d3.min.css">
	<link rel="stylesheet" type="text/css" href="../css/main.css">
	<script type="text/javascript" src="../lib/d3.v3.js"></script>
	<script type="text/javascript" src="../lib/nv.d3.min.js"></script>
</head>

<body>
	<div id="wrapper" class="container">
		<!-- Navbar content -->
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
			  <!-- Brand and toggle get grouped for better mobile display -->
			  <div class="navbar-header">
			    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			      <span class="sr-only">Toggle navigation</span>
			      <span class="icon-bar"></span>
			      <span class="icon-bar"></span>
			      <span class="icon-bar"></span>
			    </button>
			    <!-- <img id="logo" class="pull-left" src="assets/monkey.png"> -->
			    <a class="navbar-brand" href="#">Fitness Monkey</a>
			  </div>

			  <div>


			  <!-- Collect the nav links, forms, and other content for toggling -->
			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			    <ul class="nav navbar-nav navbar-right">
			    	<li><a href="#playbook">Playbook</a></li>
			      	<li><a href="#education">Education</a></li>
			      	<li><a href="#community">Community</a></li>
			      	<li><a href="#events">Events</a></li>
			      	<li><a href="#gear">Gear</a></li>
			    	<li><a href="#">Members: <span id="num">0</span></a></li>
			    </ul>
			  </div><!-- /.navbar-collapse -->
			</div><!-- /.container-fluid -->
		</nav>

		
		

		<div class="row">
			<div class="col-md-4">
				<div class="row">
					<h1>Data Side</h1>
					<div>
						Number of Workouts
						<h3 id="workoutNum">31</h3>
						<div class="btn btn-sm add"></div>
					</div>
					<div>
						Days since last relapse
						<h3 id="lastRelapse">63</h3>
					</div>
				</div>

				<div class="row">
					<form id="add-workout">
					  	<div class="form-group">
					    	<label for="type-input">What type of workout?</label>
					    	<input type="text" class="form-control" id="type-input" placeholder="Type of workout">
					  	</div>
					  	<div class="form-group">
					    	<label for="duration-input">What was the duration?</label>
					    	<input type="number" class="form-control" id="duration-input" placeholder="duration in minutes">
					  	</div>
					  	<div class="form-group">
					    	<label for="intensity-input">What was the intensity (1 - 9)</label>
					    	<input type="number" id="intensity-input">
					  	</div>
					  	<button type="submit" class="btn btn-default">Submit</button>
					</form>
				</div>
			</div>
			
			<div class="col-md-8">
				<div class="row">
					<h2>Line Chart</h2>
					<div id="chartZoom">
	    				<a href="#" id="zoomIn">Zoom In</a> 
	    				<a href="#" id="zoomOut">Zoom Out</a>
					</div>

					<div id="workout-line-chart">
						<svg></svg>
					</div>
				</div>
			</div>
		</div>

		
		
	</div>

	<script type="text/javascript" src="../lib/jquery.js"></script>
	<script type="text/javascript" src="../bootstrap/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../resources/holderJS_lite/lib/holder.min.js"></script>
	<script type="text/javascript" src="../scripts/joeScript.js"></script>
	<script type="text/javascript" src="../scripts/script.js"></script>


	<script type='text/javascript'>

		$(function() {
			var workoutData;

			function loadData(data){
				workoutData = data.workouts;
				updateCharts()
			}

			d3.json('../data/workouts.json', loadData);

			function updateCharts(){
				$('#workoutNum').text(workoutData.length);
				buildLineChart(dataTransformer.typeLineChart(workoutData), "Workouts by Type", "#workout-bar-chart svg");
			};

			function buildLineChart(data, title, selector){
				nv.addGraph(function() {
			        var chart = nv.models.lineChart();
			        var fitScreen = false;
			        var width = 600;
			        var height = 300;
			        var zoom = 1;

			        chart.useInteractiveGuideline(true);
			        chart.xAxis
			            .tickFormat(d3.format(',r'));

			        chart.lines.dispatch.on("elementClick", function(evt) {
			            console.log(evt);
			        });

			        chart.yAxis
			            .axisLabel('Duration of Workouts (min)')
			            .tickFormat(d3.format(',.2f'));

			        d3.select('#workout-line-chart svg')
			            .attr('perserveAspectRatio', 'xMinYMid')
			            .attr('width', width)
			            .attr('height', height)
			            .datum(dataTransformer.typeLineChart(workoutData));

        			setChartViewBox();
        			resizeChart();

			        nv.utils.windowResize(resizeChart);

			        d3.select('#zoomIn').on('click', zoomIn);
			        d3.select('#zoomOut').on('click', zoomOut);

			        function setChartViewBox() {
			            var w = width * zoom,
			                h = height * zoom;

			            chart
			                .width(w)
			                .height(h);

			            d3.select('#workout-line-chart svg')
			                .attr('viewBox', '0 0 ' + w + ' ' + h)
			                .transition().duration(500)
			                .call(chart);
			        }

			        function zoomOut() {
			            zoom += .25;
			            setChartViewBox();
			        }

			        function zoomIn() {
			            if (zoom <= .5) return;
			            zoom -= .25;
			            setChartViewBox();
			        }

			        // This resize simply sets the SVG's dimensions, without a need to recall the chart code
			        // Resizing because of the viewbox and perserveAspectRatio settings
			        // This scales the interior of the chart unlike the above
			        function resizeChart() {
			            var container = d3.select('#workout-line-chart');
			            var svg = container.select('svg');

			            if (fitScreen) {
			                // resize based on container's width AND HEIGHT
			                var windowSize = nv.utils.windowSize();
			                svg.attr("width", windowSize.width);
			                svg.attr("height", windowSize.height);
			            } else {
			                // resize based on container's width
			                var aspect = chart.width() / chart.height();
			                var targetWidth = parseInt(container.style('width'));
			                svg.attr("width", targetWidth);
			                svg.attr("height", Math.round(targetWidth / aspect));
			            }
			        }

	        		return chart;
    			});
			}

			var dataTransformer = {
				typeLineChart: function(data){
					var objStorage = [];
					data.forEach(function(item, idx){
						objStorage.push({x: idx, y: item.duration})
					});
					var results = [
							{
								values: objStorage,
								key: "Duration of Workouts",
								color: "dodgerblue"	
							}
						];
					return results;
				}
			};
			
			$('#add-workout').on('submit', function(e){
				e.preventDefault();
				var type = $('#type-input').val();
				var duration = $('#duration-input').val();
				var intensity = $('#intensity-input').val();
				var date = new Date();

				workoutData.push({date: date, type: type, duration: duration, intensity: intensity});
				updateCharts();
			});
	})
	</script>
</body>